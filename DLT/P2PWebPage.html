<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carpool DApp</title>
    <style>
        body {
    font-family: Arial, sans-serif;
    background-color: #f4f4f4;
    color: #333;
    margin: 0;
    padding: 0;
}

.container {
    max-width: 800px;
    margin: 20px auto;
    padding: 20px;
    background-color: #fff;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.form {
    margin-bottom: 20px;
}

input, button {
    display: block;
    width: 100%;
    padding: 10px;
    margin-top: 5px;
}

button {
    background-color: #1c6b30;
    color: white;
    border: none;
    cursor: pointer;
}

button:hover {
    opacity: 0.8;
}
    </style>
</head>
<body>
    <div class="container">
        <h1>Peer-to-Peer Carpooling DApp</h1>

        <div class="form">
            <h2>List a Ride</h2>
            <input type="text" id="startLocation" placeholder="Start Location">
            <input type="text" id="endLocation" placeholder="End Location">
            <input type="number" id="seatsAvailable" placeholder="Seats Available">
            <input type="number" id="pricePerSeat" placeholder="Price Per Seat (wei)">
            <button onclick="listRide()">List Ride</button>
        </div>

        <div class="form">
            <h2>Join a Ride</h2>
            <input type="number" id="joinRideId" placeholder="Ride ID">
            <button onclick="joinRide()">Join Ride</button>
        </div>

        <div class="form">
            <h2>Cancel a Ride</h2>
            <input type="number" id="cancelRideId" placeholder="Ride ID">
            <button onclick="cancelRide()">Cancel Ride</button>
        </div>

        <div id="ridesList"></div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/web3/dist/web3.min.js"></script>
    <script>
        const web3 = new Web3(Web3.givenProvider || "ws://localhost:8545");
let contract;
const contractAddress = '0xc0BE214931aa8877aF882dC172A2d2FF9002102A'; // Replace with your deployed contract address
const contractABI = [
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "uint256",
				"name": "rideId",
				"type": "uint256"
			}
		],
		"name": "RideCancelled",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "uint256",
				"name": "rideId",
				"type": "uint256"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "passenger",
				"type": "address"
			}
		],
		"name": "RideJoined",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "uint256",
				"name": "rideId",
				"type": "uint256"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "driver",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "string",
				"name": "start",
				"type": "string"
			},
			{
				"indexed": false,
				"internalType": "string",
				"name": "end",
				"type": "string"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "seats",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "pricePerSeat",
				"type": "uint256"
			}
		],
		"name": "RideListed",
		"type": "event"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_rideId",
				"type": "uint256"
			}
		],
		"name": "cancelRide",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_rideId",
				"type": "uint256"
			}
		],
		"name": "getRideDetails",
		"outputs": [
			{
				"components": [
					{
						"internalType": "uint256",
						"name": "id",
						"type": "uint256"
					},
					{
						"internalType": "address payable",
						"name": "driver",
						"type": "address"
					},
					{
						"internalType": "string",
						"name": "startLocation",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "endLocation",
						"type": "string"
					},
					{
						"internalType": "uint256",
						"name": "seatsAvailable",
						"type": "uint256"
					},
					{
						"internalType": "uint256",
						"name": "pricePerSeat",
						"type": "uint256"
					},
					{
						"internalType": "bool",
						"name": "active",
						"type": "bool"
					}
				],
				"internalType": "struct Carpooling.Ride",
				"name": "",
				"type": "tuple"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_rideId",
				"type": "uint256"
			}
		],
		"name": "getRidePassengers",
		"outputs": [
			{
				"internalType": "address[]",
				"name": "",
				"type": "address[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_rideId",
				"type": "uint256"
			}
		],
		"name": "joinRide",
		"outputs": [],
		"stateMutability": "payable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_startLocation",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_endLocation",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "_seatsAvailable",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "_pricePerSeat",
				"type": "uint256"
			}
		],
		"name": "listRide",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "nextRideId",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "ridePassengers",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "rides",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "id",
				"type": "uint256"
			},
			{
				"internalType": "address payable",
				"name": "driver",
				"type": "address"
			},
			{
				"internalType": "string",
				"name": "startLocation",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "endLocation",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "seatsAvailable",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "pricePerSeat",
				"type": "uint256"
			},
			{
				"internalType": "bool",
				"name": "active",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
]

document.addEventListener('DOMContentLoaded', () => {
    contract = new web3.eth.Contract(contractABI, contractAddress);
});

async function listRide() {
    const startLocation = document.getElementById('startLocation').value;
    const endLocation = document.getElementById('endLocation').value;
    const seatsAvailable = document.getElementById('seatsAvailable').value;
    const pricePerSeat = document.getElementById('pricePerSeat').value;
    
    const accounts = await web3.eth.getAccounts();
    contract.methods.listRide(startLocation, endLocation, seatsAvailable, pricePerSeat)
        .send({ from: accounts[0] })
        .then(result => console.log(result))
        .catch(error => console.error(error));
}

async function joinRide() {
    const rideId = document.getElementById('joinRideId').value;
    const accounts = await web3.eth.getAccounts();
    const rideDetails = await contract.methods.rides(rideId).call();
    
    contract.methods.joinRide(rideId)
        .send({ from: accounts[0], value: rideDetails.pricePerSeat })
        .then(result => console.log(result))
        .catch(error => console.error(error));
}

async function cancelRide() {
    const rideId = document.getElementById('cancelRideId').value;
    const accounts = await web3.eth.getAccounts();
    
    contract.methods.cancelRide(rideId)
        .send({ from: accounts[0] })
        .then(result => console.log(result))
        .catch(error => console.error(error));
}
    </script>
</body>
</html>